const menuConfig = [
  [
    {
      type: "button",
      shortcutKey: "Shift+Space",
      toggleClass: ["paly", "pause"],
      title: "播放/暂停",
      onToggle: [animationStart, animationStop],
      icon: {
        paly: `<svg viewBox="0 0 1024 1024" width="28" height="28">
          <path d="M512 113c220 0 399 179 399 399S732 911 512 911 113 732 113 512s179-399 399-399m0-42C268.4 71 71 268.4 71 512s197.4 441 441 441 441-197.4 441-441S755.6 71 512 71z"></path>
          <path d="M440.3 697.6c-29.9 0-54.3-24.3-54.3-54.3V380.6c0-29.9 24.4-54.3 54.3-54.3 9.4 0 18.7 2.5 27 7.3L694.9 465c17 9.8 27.1 27.4 27.1 47s-10.1 37.2-27.1 47L467.4 690.3c-8.4 4.8-17.7 7.3-27.1 7.3z m0-329.2c-5.9 0-12.3 4.7-12.3 12.3v262.7c0 10.3 10.9 14.9 18.4 10.6l227.5-131.4c5.5-3.2 6.1-8.4 6.1-10.6s-0.6-7.4-6.1-10.6L446.4 370c-2-1.1-4-1.6-6.1-1.6z"></path>
        </svg>`,
        pause: `<svg viewBox="0 0 1024 1024" width="28" height="28">
          <path d="M425.1 648.5c-11.6 0-21-9.5-21-21v-231c0-11.6 9.4-21 21-21 11.5 0 21 9.4 21 21v231c0 11.5-9.4 21-21 21z m168 0c-11.6 0-21-9.5-21-21v-231c0-11.6 9.4-21 21-21 11.5 0 21 9.4 21 21v231c0 11.5-9.4 21-21 21z"></path>
          <path d="M512 113c220 0 399 179 399 399S732 911 512 911 113 732 113 512s179-399 399-399m0-42C268.4 71 71 268.4 71 512s197.4 441 441 441 441-197.4 441-441S755.6 71 512 71z"></path>
        </svg>`,
      },
    },
    {
      type: "button",
      title: "复原",
      shortcutKey: "Shift+R",
      onClick({ nodes, controls }) {
        if (controls[0].classList.contains("pause")) {
          controls[0].click();
        }
        nodes.inscription.scrollTop = 0;
      },
      icon: `<svg viewBox="0 0 1024 1024" width="26" height="26"><path d="M281.12 128C151.008 206.4 64 349.024 64 512c0 247.424 200.576 448 448 448a32 32 0 0 0 0-64c-212.064 0-384-171.936-384-384 0-154.976 91.808-288.512 224-349.184V288.64c0 17.344 14.848 31.392 32 31.392 17.664 0 32-13.76 32-31.392V95.392a30.88 30.88 0 0 0-9.376-21.984l0.096-0.224A30.944 30.944 0 0 0 384.608 64H191.392C174.048 64 160 78.848 160 96c0 17.664 13.76 32 31.392 32h89.728z m461.76 768C872.992 817.6 960 674.976 960 512c0-247.424-200.576-448-448-448a32 32 0 0 0 0 64c212.064 0 384 171.936 384 384 0 154.976-91.808 288.512-224 349.184V735.36c0-17.344-14.848-31.392-32-31.392-17.664 0-32 13.76-32 31.392v193.216c0 8.576 3.616 16.32 9.376 21.984l-0.096 0.224a30.944 30.944 0 0 0 22.112 9.184h193.216c17.344 0 31.392-14.848 31.392-32 0-17.664-13.76-32-31.392-32H742.88z"></path></svg>`,
    },
    {
      type: "button",
      toggleClass: ["full", "shrink"],
      shortcutKey: "Shift+F",
      title: "全屏/退出全屏",
      onToggle: [
        function (_, onEnd) {
          document.documentElement.requestFullscreen();
          document.onfullscreenchange = () => {
            if (!document.fullscreenElement) {
              onEnd();
            }
          };
        },
        function () {
          document.exitFullscreen();
        },
      ],
      icon: {
        full: `<svg viewBox="0 0 1024 1024" width="28" height="28"><path d="M193.349046 210.094207v130.995519c0.084979 23.530755-6.042025 43.024996-29.555785 43.105726h-0.195452c-23.649726-0.025494-33.940714-19.53673-34.004448-43.207701v-169.916017a41.580349 41.580349 0 0 1 41.784299-41.809792h170.328166c23.641228 0.029743 42.795552 10.707386 42.825294 34.36561 0.029743 23.535004-19.009859 29.445311-42.523618 29.475054H210.344896a16.995851 16.995851 0 0 0-16.99585 16.99585z m620.306058-16.99585H681.992498c-23.513759-0.025494-42.549112-5.935801-42.523618-29.470805 0.029743-23.662473 19.184066-34.335867 42.825294-34.369859H852.78805a41.580349 41.580349 0 0 1 41.618589 41.809792v169.920266c-0.063734 23.666722-10.354722 43.182207-34.000199 43.21195h-0.199701c-23.513759-0.084979-29.636515-19.57922-29.555785-43.109975v-130.995519a16.995851 16.995851 0 0 0-16.99585-16.99585zM210.344896 830.09434H342.007502c23.513759 0.025494 42.553361 5.94005 42.523618 29.470805-0.029743 23.662473-19.184066 34.335867-42.825294 34.369859H171.21195a41.580349 41.580349 0 0 1-41.618589-41.809792v-169.916017c0.063734-23.670971 10.354722-43.186456 34.004448-43.21195h0.195452c23.513759 0.084979 29.636515 19.574971 29.555785 43.105726v130.995519a16.995851 16.995851 0 0 0 16.99585 16.99585z m620.306058-16.859884v-130.991269c-0.084979-23.535004 6.042025-43.024996 29.555785-43.109975h0.199701c23.645477 0.029743 33.936465 19.545228 34.000199 43.21195v169.916016a41.580349 41.580349 0 0 1-41.784299 41.809793h-170.328166c-23.641228-0.029743-42.795552-10.707386-42.825294-34.36561-0.025494-23.535004 19.009859-29.445311 42.523618-29.475054H813.655104a16.995851 16.995851 0 0 0 16.99585-16.995851z"></path></svg>`,
        shrink: `<svg viewBox="0 0 1024 1024" width="28" height="28"><path d="M319.978667 304.622933V173.085867c-0.085333-23.633067 6.0672-43.204267 29.678933-43.2896h0.196267c23.748267 0.029867 34.082133 19.626667 34.146133 43.392v170.624a41.7536 41.7536 0 0 1-41.9584 41.984H171.003733c-23.739733-0.029867-42.973867-10.752-43.003733-34.5088-0.029867-23.633067 19.089067-29.568 42.7008-29.597867H302.912a17.066667 17.066667 0 0 0 17.066667-17.066667z m0 418.346667a17.066667 17.066667 0 0 0-17.066667-17.066667H170.7008c-23.611733-0.0256-42.730667-5.960533-42.7008-29.5936 0.029867-23.761067 19.264-34.478933 43.003733-34.513066H342.208a41.7536 41.7536 0 0 1 41.792 41.984v170.628266c-0.064 23.765333-10.397867 43.362133-34.146133 43.392h-0.196267c-23.611733-0.085333-29.76-19.6608-29.678933-43.2896v-131.541333z m384.042666-418.346667a17.066667 17.066667 0 0 0 17.066667 17.066667H853.2992c23.611733 0.029867 42.730667 5.9648 42.7008 29.597867-0.029867 23.7568-19.264 34.478933-43.003733 34.5088H681.792a41.7536 41.7536 0 0 1-41.792-41.984v-170.624c0.064-23.765333 10.397867-43.362133 34.146133-43.392h0.196267c23.611733 0.085333 29.76 19.656533 29.678933 43.2896v131.541333z m0 418.346667v131.541333c0.085333 23.6288-6.0672 43.204267-29.678933 43.285334h-0.196267c-23.748267-0.0256-34.082133-19.618133-34.146133-43.387734v-170.624a41.7536 41.7536 0 0 1 41.9584-41.984h171.037867c23.739733 0.029867 42.973867 10.752 43.003733 34.5088 0.029867 23.633067-19.089067 29.568-42.7008 29.597867H721.088a17.066667 17.066667 0 0 0-17.066667 17.066667z"></path></svg>`,
      },
    },
    {
      type: "button",
      toggleClass: "vertical",
      shortcutKey: "Shift+H",
      title: "水平翻转",
      onToggle: [
        function ({ nodes, config }) {
          config.flipVertical = true;
          nodes.inscription.style.transform = `scale(-1,${
            config.flipHorizontal ? -1 : 1
          })`;
        },
        function ({ nodes, config }) {
          config.flipVertical = false;
          nodes.inscription.style.transform = `scale(1,${
            config.flipHorizontal ? -1 : 1
          })`;
        },
      ],
      icon: `<svg viewBox="0 0 1052 1024" width="28" height="28" style="transform:rotate(-90deg)"><path d="M309.33333314 314.66666656c0-5.33333344 2.66666625-13.33333313 5.33333342-18.66666657C357.33333312 183.99999969 429.33333312 111.9999997 512 111.9999997c133.33333312 0 240 192 240 426.66666655s-106.66666688 426.66666656-240 426.6666675c-101.33333345 0-186.66666656-109.33333311-221.33333344-266.66666719 0-5.33333344-2.66666624-10.66666687-5.33333343-18.66666656 0-2.66666625-2.66666625-5.33333344-5.33333344-7.9999997-5.33333344-5.33333344-13.33333313-2.66666625-18.66666656 2.66666626l-24 29.33333344c-13.33333313 16.00000031-40.00000031 18.66666656-55.99999969 5.33333344-16.00000031-13.33333313-18.66666656-40.00000031-5.33333344-55.99999969l101.33333344-125.33333344c13.33333313-16.00000031 40.00000031-18.66666656 55.99999968-5.33333343l125.33333344 101.33333343c16.00000031 13.33333313 18.66666656 40.00000031 5.33333344 55.99999969-13.33333313 16.00000031-40.00000031 18.66666656-55.99999969 5.33333345l-18.66666656-16.00000032c-2.66666625-2.66666625-7.99999969-2.66666625-10.66666688-2.66666625-7.99999969 2.66666625-10.66666688 7.99999969-10.66666687 15.99999937 0 5.33333344 2.66666624 10.66666687 2.66666625 16.00000031 29.33333344 114.66666656 88.00000031 186.66666656 141.33333375 186.66666657 74.66666624 0 160.00000031-149.33333344 160.00000031-346.66666688S589.33333344 192.00000031 512 192.00000031c-45.33333375 0-90.66666656 50.66666625-122.66666625 133.33333312-5.33333344 16.00000031-21.33333375 29.33333344-37.33333406 29.33333344-24 0-42.66666656-18.66666656-42.66666655-40.00000031z"></path></svg>`,
    },
    {
      type: "button",
      toggleClass: "horizontal",
      title: "垂直翻转",
      shortcutKey: "Shift+V",
      onToggle: [
        function ({ nodes, config }) {
          config.flipHorizontal = true;
          nodes.inscription.style.transform = `scale(${
            config.flipVertical ? -1 : 1
          },-1)`;
        },
        function ({ nodes, config }) {
          config.flipHorizontal = false;
          nodes.inscription.style.transform = `scale(${
            config.flipVertical ? -1 : 1
          },1)`;
        },
      ],
      icon: `<svg viewBox="0 0 1052 1024" width="28" height="28"><path d="M309.33333314 314.66666656c0-5.33333344 2.66666625-13.33333313 5.33333342-18.66666657C357.33333312 183.99999969 429.33333312 111.9999997 512 111.9999997c133.33333312 0 240 192 240 426.66666655s-106.66666688 426.66666656-240 426.6666675c-101.33333345 0-186.66666656-109.33333311-221.33333344-266.66666719 0-5.33333344-2.66666624-10.66666687-5.33333343-18.66666656 0-2.66666625-2.66666625-5.33333344-5.33333344-7.9999997-5.33333344-5.33333344-13.33333313-2.66666625-18.66666656 2.66666626l-24 29.33333344c-13.33333313 16.00000031-40.00000031 18.66666656-55.99999969 5.33333344-16.00000031-13.33333313-18.66666656-40.00000031-5.33333344-55.99999969l101.33333344-125.33333344c13.33333313-16.00000031 40.00000031-18.66666656 55.99999968-5.33333343l125.33333344 101.33333343c16.00000031 13.33333313 18.66666656 40.00000031 5.33333344 55.99999969-13.33333313 16.00000031-40.00000031 18.66666656-55.99999969 5.33333345l-18.66666656-16.00000032c-2.66666625-2.66666625-7.99999969-2.66666625-10.66666688-2.66666625-7.99999969 2.66666625-10.66666688 7.99999969-10.66666687 15.99999937 0 5.33333344 2.66666624 10.66666687 2.66666625 16.00000031 29.33333344 114.66666656 88.00000031 186.66666656 141.33333375 186.66666657 74.66666624 0 160.00000031-149.33333344 160.00000031-346.66666688S589.33333344 192.00000031 512 192.00000031c-45.33333375 0-90.66666656 50.66666625-122.66666625 133.33333312-5.33333344 16.00000031-21.33333375 29.33333344-37.33333406 29.33333344-24 0-42.66666656-18.66666656-42.66666655-40.00000031z"></path></svg>`,
    },
    {
      type: "file",
      title: "打开文件",
      shortcutKey: "Shift+O",
      style: { display: "none" },
      showValue: false,
      attr: { accept: ".txt, .md, .doc, .docx" },
      async onChange(tool) {
        const file = this.files[0]; // 获取选择的第一个文件
        if (!file) return window.alert("没有读取到文件");
        const size = file.size / 1024 / 1024;
        if (size > 10) {
          window.alert("文件过大，请选择小于10M的文件");
          return;
        } else if (["doc", "docx"].some(k => file.name.endsWith(`.${k}`))) {
          tool.loading("解析doc文件中...");
          const hideLoading = syncWait(() => tool.hideLoading(), 1000);
          let text = "";
          try {
            if (!window.mammoth) {
              await tool.addScript(
                "https://unpkg.com/mammoth@1.4.19/mammoth.browser.min.js"
              );
            }
            if (!window.mammoth) throw Error("mammoth not found!");
            const arrayBuffer = await file.arrayBuffer();
            const result = await window.mammoth.extractRawText({ arrayBuffer });
            text = result.value;
          } catch (error) {
            console.error(error);
            window.alert("解析doc文件失败");
          } finally {
            hideLoading().then(() => {
              if (text) tool.updateContent(text);
            });
          }
        } else {
          const reader = new FileReader();
          reader.onload = function (e) {
            const content = e.target.result; // 文件内容
            tool.updateContent(content);
          };
          reader.readAsText(file); // 读取文件内容为文本
        }
      },
      icon: `<svg viewBox="0 0 1024 1024" width="28" height="28"><path d="M506 894.2a33 32.9 0 1 0 66 0 33 32.9 0 1 0-66 0Z"></path><path d="M864 388.7v-4.4c0-70.7-57.3-128-128-128H511.8l-82.5-110.9c-7.4-12.9-18-16.2-27.3-16l-0.1-0.1H192.1c-70.7 0-128 57.3-128 128v542.1c0 70.7 57.3 128 128 128H407v-0.4c18.2 0 33-14.7 33-32.9s-14.8-32.9-33-32.9c-1 0-2.1 0.1-3.1 0.1h-181c-35.3 0-64-28.7-64-64 0-5.5 0.7-10.9 2-16L234 498.9l0.2-0.1c6.7-28.1 31.9-49 62.1-49.1l0.2-0.1h532.2c1.3-0.1 2.5-0.1 3.8-0.1 35.3 0 64 28.7 64 64 0 6.7-1.1 13.3-3 19.4v0.1L821 812.8c-0.1 0.6-0.3 1.1-0.4 1.7l-1.5 5.8-0.5 0.4c-1.5 3.9-3.4 7.5-5.5 11h-1.3c-2.6 4.7-5.8 9.1-9.5 12.9-11.4 10.6-26.7 17.1-43.4 17.1-1.3 0-2.6 0-3.8-0.1h-80.8c-1-0.1-2.1-0.1-3.1-0.1-18.2 0-33 14.7-33 32.9s14.8 32.9 33 32.9v0.2H763l0.5-0.4c59.1-0.2 108.7-40.4 123.2-95l0.2-0.2 67.8-285.5c2.9-10.8 4.5-22.1 4.5-33.8-0.1-59.5-40.5-109.5-95.2-123.9z m-571.5-4.9c-62 0-113.7 44.2-125.5 102.7l-0.5 0.4-38 160.3V257c0-35.3 28.7-64 64-64H383l82.7 111.3c6.6 11.4 19.2 17.2 31.5 15.8h238.5c35.2 0 63.8 28.5 64 63.7H292.5z"></path></svg>`,
    },
    {
      type: "button",
      title: "保存",
      shortcutKey: "Shift+S",
      onClick({ nodes }) {
        try {
          if (!window.confirm("确认保存为文件?")) return;
          saveFile("inscription.txt", nodes.inscription.value);
          window.alert("保存成功");
        } catch (error) {
          console.error(error);
          window.alert("保存失败");
        }
      },
      icon: `<svg viewBox="0 0 1024 1024" width="28" height="28"><path d="M579.7 291.4c18.8 0 34.1-15.3 34.1-34.1v-34.1c0-18.8-15.4-34.1-34.1-34.1-18.8 0-34.1 15.3-34.1 34.1v34.1c0 18.7 15.4 34.1 34.1 34.1z"></path><path d="M944.7 216.3L808.2 79.9c-6.8-6.8-15.3-10.2-23.9-10.2H170.4c-56.3 0-102.3 46-102.3 102.3v682.1c0 56.3 46 102.3 102.3 102.3H852.5c56.3 0 102.3-46 102.3-102.3V240.2c0.1-8.5-3.3-17-10.1-23.9zM358 137.9h307v182.5c0 11.9-10.2 22.2-22.2 22.2H380.2c-11.9 0-22.2-10.2-22.2-22.2V137.9z m358.1 750.3H306.9V652.9c0-20.5 17.1-37.5 37.5-37.5h334.2c20.5 0 37.5 17 37.5 37.5v235.3z m170.6-34.1c0 18.8-15.3 34.1-34.1 34.1h-66.5V652.9c0-58-47.7-105.7-105.7-105.7h-336c-58 0-105.7 47.7-105.7 105.7v235.3h-68.2c-18.8 0-34.1-15.3-34.1-34.1V172c0-18.8 15.3-34.1 34.1-34.1h119.4v182.5c0 49.5 40.9 90.4 90.4 90.4h262.6c49.5 0 90.4-40.9 90.4-90.4V137.9h37.5l116 116v600.2z"></path></svg>`,
    },
  ],
  [
    {
      type: "progress",
      title: "播放速度",
      shortcutKey: {
        "Shift+ArrowUp"() {
          progressChangeValue.call(this, 1);
        },
        "Shift+ArrowDown"() {
          progressChangeValue.call(this, -1);
        },
      },
      icon: `<svg viewBox="0 0 1024 1024" width="24" height="24">
        <path d="M309.053 873.496a411.774 411.774 0 0 0 59.368 27.453 48.762 48.762 0 1 1-33.768 91.478 509.733 509.733 0 0 1-73.411-33.939 48.762 48.762 0 0 1 47.811-84.992zM144.238 703.39a414.72 414.72 0 0 0 34.767 55.467 48.762 48.762 0 0 1-78.263 58.149 512.244 512.244 0 0 1-42.96-68.51 48.762 48.762 0 0 1 86.48-45.106z m294.62-344.088a48.762 48.762 0 0 1 27.062 8.192L621.812 471.43a48.762 48.762 0 0 1 0 81.14L465.896 656.506a48.762 48.762 0 0 1-75.8-40.57V408.064a48.762 48.762 0 0 1 48.761-48.762zM56.514 414.11a48.762 48.762 0 0 1 43.35 53.639 421.717 421.717 0 0 0-1.78 65.901 48.762 48.762 0 1 1-97.402 4.998 519.973 519.973 0 0 1 2.194-81.188 48.762 48.762 0 0 1 53.638-43.35zM184.881 180.42a48.762 48.762 0 0 1 6.729 68.632 415.646 415.646 0 0 0-37.474 53.687 48.762 48.762 0 0 1-84.114-49.322 513.17 513.17 0 0 1 46.226-66.292 48.762 48.762 0 0 1 68.633-6.705z m554.545-14.994l-5.681-3.657a411.916 411.916 0 0 0-157.428-59.295l-11.581-1.633a414.866 414.866 0 0 0-1-0.122l-10.045-1.122-0.877-0.097 0.268 0.024 0.61 0.073 3.364 0.342-3.974-0.415-2.682-0.244-8.558-0.707-0.877-0.049 0.658 0.05h0.22l2.706 0.194-0.537-0.024-2.39-0.17-1.779-0.147-0.731-0.049-1.488-0.073 1.195 0.049 0.293 0.024 0.341 0.049-0.634-0.073-2.755-0.147-7.826-0.365 3.364 0.122h-0.707l-2.657-0.122-1.804-0.073-1.366-0.05h-0.902l0.293-0.024-5.608-0.121a423.79 423.79 0 0 0-6.851-0.05l-3.657-0.145-0.317-0.025-2.438-0.244-0.488-0.122h-0.122l-2.096-0.317a48.42 48.42 0 0 1-14.97-5.51l-1.39-0.829a48.713 48.713 0 0 1-9.752-7.85l-0.903-0.975a48.957 48.957 0 0 1-2.34-2.78l-1.317-1.78-0.707-1a48.908 48.908 0 0 1-8.265-27.184A48.762 48.762 0 0 1 512 0c8.558 0 17.067 0.22 25.551 0.634l6.242 0.341a516.535 516.535 0 0 1 31.597 2.926l2.048 0.244c4.828 0.61 9.655 1.292 14.458 2.048l0.586 0.097 0.243 0.049a508.952 508.952 0 0 1 199.997 77.434l0.293 0.195 0.756 0.488a490.257 490.257 0 0 1 20.382 14.19l1.61 1.194a344.856 344.856 0 0 1 8.971 6.754l1.902 1.487c6.364 4.95 12.58 10.07 18.7 15.287l1.707 1.462C955.416 218.722 1024 357.352 1024 512c0 48.567-6.754 95.525-19.383 140.044l-0.658 2.219-0.488 1.707a511.269 511.269 0 0 1-119.93 208.31l-0.097 0.098-0.073 0.097-7.095 7.266-3.292 3.34a515.12 515.12 0 0 1-9.923 9.606 510.488 510.488 0 0 1-264.045 131.95l-2.365 0.39c-14.995 2.511-30.233 4.34-45.69 5.51l-1.731 0.122-0.561 0.049A521.646 521.646 0 0 1 512 1024l-3.657-0.122a48.762 48.762 0 0 1 0-97.28l3.657-0.122c10.191 0 20.31-0.366 30.33-1.097l11.313-0.975 2.999-0.293 5.388-0.61 0.877-0.146 0.512-0.048 0.927-0.122 3.048-0.366-1.488 0.146 2.853-0.365 11.069-1.634c4.12-0.683 8.24-1.414 12.337-2.219l0.829-0.195 3.388-0.682 11.167-2.463a412.843 412.843 0 0 0 157.745-75.313l8.606-6.826 0.634-0.537 8.216-6.948 2.39-2.024-0.927 0.78 4.072-3.584 2.145-1.95-4.437 3.95 5.193-4.657-0.682 0.634 2.145-1.926-1.097 0.95 3.267-3.023 4.632-4.34A414.55 414.55 0 0 0 903.9 647.242l3.048-9.167 1.585-5.071 2.682-9.265 0.22-0.756 1.56-5.656 0.438-1.829-1.78 6.73 2.512-9.656 0.975-3.852 0.78-3.267 0.83-3.852 0.365-1.61-0.341 1.44 1.487-6.974a417.89 417.89 0 0 0-5.047-186.806l-2.658-9.802-1.706-5.9-0.659-2.097-0.073-0.243 0.05 0.219-1.22-3.95a411.21 411.21 0 0 0-4.072-12.093l0.317 0.951-1.78-5.022-3.364-8.875-0.122-0.292-0.56-1.39-0.659-1.658A415.305 415.305 0 0 0 790.918 205.41l0.22 0.195c-6.34-5.754-12.825-11.338-19.505-16.701l-10.094-7.875-2.145-1.61-6.218-4.534-0.512-0.366-1.78-1.268-0.999-0.707-0.902-0.634 0.804 0.585-4.242-2.95a415.33 415.33 0 0 0-6.095-4.12zM420.45 55.175a48.762 48.762 0 0 1-32.037 61.073 409.6 409.6 0 0 0-60.684 24.381 48.762 48.762 0 0 1-43.398-87.332c24.137-12.02 49.225-22.09 75.044-30.16a48.762 48.762 0 0 1 61.075 32.037z"></path>
    </svg>`,
      value: tool => tool.config.speed,
      attr: { min: "1", max: "50", step: "1" },
      onChange(tool) {
        tool.updateConfig("speed", +this.value);
      },
    },
    {
      type: "progress",
      title: "字号",
      shortcutKey: {
        "Shift++"() {
          progressChangeValue.call(this, 1);
        },
        "Shift+_"() {
          progressChangeValue.call(this, -1);
        },
      },
      icon: `<svg viewBox="0 0 1024 1024" width="28" height="28"><path d="M859.776 405.333333H590.890667C570.88 405.333333 554.666667 390.997333 554.666667 373.333333s16.213333-32 36.224-32h268.885333c19.989333 0 36.224 14.336 36.224 32s-16.213333 32-36.224 32"></path><path d="M693.333333 507.776V238.890667c0-20.010667 14.336-36.224 32-36.224s32 16.213333 32 36.224v268.885333c0 19.989333-14.336 36.224-32 36.224s-32-16.213333-32-36.224"></path><path d="M448.448 256l1.621333 4.096 229.12 584.405333L682.666667 853.333333h-86.464l-1.578667-4.16-60.416-159.573333H275.626667l-60.416 159.573333-1.578667 4.16H128l3.456-8.832 229.141333-584.405333 1.621334-4.096h86.229333z m-42.752 92.330667l-103.936 271.872h206.357333l-102.4-271.872z"></path></svg>`,
      value: tool => tool.config.fontsize,
      onInit: updateFontSize,
      attr: { min: "4", max: "30", step: "1" },
      onChange(tool) {
        tool.updateConfig("fontsize", +this.value);
        updateFontSize(tool);
      },
    },
  ],
  [
    {
      type: "progress",
      title: "宽度",
      shortcutKey: {
        "Shift+ArrowLeft"() {
          progressChangeValue.call(this, 1);
        },
        "Shift+ArrowRight"() {
          progressChangeValue.call(this, -1);
        },
      },
      icon: `<svg viewBox="0 0 1024 1024" width="28" height="28"><path d="M276.845714 804.571429h107.154286s74.971429-290.084571 111.835429-473.051429C532.662857 514.633143 619.629714 804.571429 619.629714 804.571429h93.476572L841.142857 219.428571h-74.971428l-100.205715 498.139429L532.041143 219.428571H460.434286L327.387429 717.568 226.304 219.428571H146.285714l130.56 585.142858z"></path></svg>`,
      value: tool => tool.config.width,
      onInit: updatePanelWidth,
      attr: { min: "40", max: "95", step: "1" },
      onChange(tool) {
        tool.updateConfig("width", +this.value);
        updatePanelWidth(tool);
      },
    },
    {
      type: "color",
      title: "字体颜色",
      icon: `<svg viewBox="0 0 1024 1024" width="28" height="28"><path d="M710.58 462.01a54.9 54.9 0 1 0 109.8 0 54.9 54.9 0 1 0-109.8 0z m-91.5-146.4a54.9 54.9 0 1 0 109.8 0 54.9 54.9 0 1 0-109.8 0z m-183.002-45.751a54.9 54.9 0 1 0 109.8 0 54.9 54.9 0 1 0-109.8 0z m-164.702 91.5a54.9 54.9 0 1 0 109.8 0 54.9 54.9 0 1 0-109.8 0z m-64.05 164.702a54.9 54.9 0 1 0 109.8 0 54.9 54.9 0 1 0-109.8 0z m273.587 430.97c-19.215 0-39.346-1.83-61.306-4.576l-5.49-0.915C258.566 927.75 152.425 776.774 147.85 770.37c-150.062-228.752-75.031-460.25 66.795-588.35C355.557 53.916 590.714-0.984 796.591 164.632 929.267 271.69 969.527 419.92 971.357 426.325v1.83c19.215 104.311 3.66 181.172-46.665 230.583-76.86 74.115-204.047 50.325-221.432 46.665-23.79-2.745-41.176 4.575-53.986 20.13-13.725 17.385-16.47 40.26-11.895 53.986 12.81 38.43 14.64 67.71 5.49 89.67-26.535 57.646-80.52 87.841-161.956 87.841z m-58.56-60.391l5.49 0.915c88.755 13.725 142.74-3.66 164.7-53.07 0-0.916 4.576-12.81-7.32-49.411-11.894-32.94-2.744-75.946 21.046-105.226 24.705-31.11 61.306-44.836 104.31-40.26l2.746 0.915c0.915 0 114.376 24.705 172.937-32.026 35.685-34.77 46.665-95.16 31.11-179.341-3.66-11.896-43.006-140.912-156.467-231.498-179.341-146.4-385.218-97.905-509.66 14.64C136.87 326.59 52.69 525.147 193.6 740.174c0.915 0 96.991 137.252 228.752 156.467z"></path></svg>`,
      value: tool => tool.config.color,
      onInit: updatePanelColor,
      style: { width: "32px" },
      showValue: false,
      onChange(tool) {
        tool.updateConfig("color", this.value);
        updatePanelColor(tool);
      },
    },
    {
      type: "color",
      title: "背景颜色",
      icon: `<svg viewBox="0 0 1024 1024" width="32" height="32"><path d="M245.44 132.288l554.24 320a32 32 0 0 1 2.688 53.76 63.104 63.104 0 0 1-6.976 17.664l-20.352 35.264 0.832 3.072-3.072 0.832-201.408 348.8a64 64 0 0 1-87.424 23.424L96 711.104a64 64 0 0 1-23.424-87.424l224-387.968-83.136-48a32 32 0 1 1 32-55.424z m335.936 634.176l-178.688 47.808 113.28 65.408 65.408-113.216z m104-180.16L222.592 710.272l101.824 58.752 302.208-80.96 58.752-101.76z m151.552-67.84l4.032 3.52c69.504 59.2 106.688 101.824 114.304 130.176l1.728 8a79.936 79.936 0 0 1-57.92 90.048l-8 1.728c-40 6.336-79.104-18.56-89.728-58.496l-1.28-6.08c-4.736-29.888 6.72-84.032 35.2-163.84l1.664-5.12zM352 267.712L128 655.68l16.192 9.344 586.432-157.12 9.344-16.192-387.968-224z"></path></svg>`,
      value: tool => tool.config.bgColor,
      onInit: updatePanelBgColor,
      style: { width: "32px" },
      showValue: false,
      onChange(tool) {
        tool.updateConfig("bgColor", this.value);
        updatePanelBgColor(tool);
      },
    },
  ],
];

function updateFontSize(tool) {
  updateRootStyle("--inscription-size", `${tool.config.fontsize}px`);
}

function updatePanelWidth(tool) {
  updateRootStyle("--inscription-width", `${tool.config.width}%`);
}
function updatePanelColor(tool) {
  updateRootStyle("--inscription-color", `${tool.config.color}`);
}
function updatePanelBgColor(tool) {
  updateRootStyle("--background-color", `${tool.config.bgColor}`);
}
function updatePanelWidth(tool) {
  updateRootStyle("--inscription-width", `${tool.config.width}%`);
}

function progressChangeValue(value) {
  const input = this.getElementsByTagName("input")[0];
  if (input) input.value = +input.value + value;
}

function updateRootStyle(key, value) {
  document.documentElement.style.setProperty(key, value);
}

function animationStart({ nodes, config, timer } = {}, onEnd) {
  if (timer.animation) return;
  let scrollTop = 0;
  function move() {
    // 1px误差
    if (
      nodes.inscription.scrollTop + nodes.inscription.clientHeight >=
      nodes.inscription.scrollHeight - 1
    ) {
      return onEnd();
    }
    timer.animation = window.requestAnimationFrame(() => {
      scrollTop += config.speed / 45;
      while (scrollTop >= 0.3) {
        nodes.inscription.scrollTop += 0.3;
        scrollTop -= 0.3;
      }
      move();
    });
  }
  move();
}

function animationStop({ timer } = {}) {
  if (timer.animation) {
    window.cancelAnimationFrame(timer.animation);
    timer.animation = null;
  }
}

function syncWait(func, _time = 300) {
  const startTime = Date.now();
  const time = typeof func === "number" ? func : _time;
  return (...params) => {
    let diff = Date.now() - startTime;
    if (diff < time) diff = time - diff;
    else diff = 0;
    if (typeof func === "function") {
      return sleep(func, diff, ...params);
    } else {
      return sleep(diff);
    }
  };
}
function sleep(func, _time = 300, ...params) {
  const time = typeof func === "number" ? func : _time;
  return new Promise(resolve =>
    setTimeout(() => {
      const result = typeof func === "function" ? func(...params) : func;
      resolve(result);
    }, time)
  );
}

function saveFile(filename, data) {
  const blob = new Blob([data], { type: "text/plain" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}
